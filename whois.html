---
layout: page
title: WHOIS Lookup
subtitle: Retrieve WHOIS information for a domain.
share-description: "IP Cow is a free service that shows you the public IP address of your device along with information about your computer and web browser. IP Cow also offers an Ookla Speedtest and other network resources and tools."
# full-width: true
---
<style>
  .available-message {
    color: green;
    font-weight: bold;
    margin-top: 20px;
  }
</style>
<form class="form-inline justify-content-center" method="GET" action="/api/whois.php">
  <input type="text" class="form-control" id="domain" name="domain" placeholder="google.com" required>
  <button type="submit" class="btn btn-primary">Check WHOIS</button>
</form>
<div id="whois-results" class="center-results"></div>
<script>
  document.querySelector('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const domain = document.getElementById('domain').value.trim();
    const resultsDiv = document.getElementById('whois-results');
    resultsDiv.innerHTML = 'Loading...';

    try {
      const startTime = performance.now();
      const response = await fetch(`/api/whois.php?domain=${encodeURIComponent(domain)}`);
      const endTime = performance.now();
      const latency = (endTime - startTime).toFixed(2);

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const data = await response.json();

      if (!data.success || data.error) {
        resultsDiv.innerHTML = data.error || 'No WHOIS data found.';
        return;
      }

      // Check if the domain is available
      if (data.available) {
        resultsDiv.innerHTML = `<div class="available-message">The domain "${domain}" is available and has not been registered.</div>`;
        return; // Skip the rest of the formatting
      }

      const whoisData = data.whois || {};

      // Build the table for registered domains
      let formatted = '<table>';
      formatted += '<tr><th>Metric</th><th>Value</th></tr>';
      formatted += `<tr><td>Domain</td><td>${domain}</td></tr>`;
      formatted += `<tr><td>Client Latency</td><td>${latency} ms</td></tr>`;
      formatted += '<tr><td colspan="2"><strong>WHOIS Data</strong></td></tr>';

      // Display WHOIS data as key-value pairs
      if (typeof whoisData === 'object' && !Array.isArray(whoisData)) {
        for (const [key, value] of Object.entries(whoisData)) {
          // Handle array values (like Name Server)
          const displayValue = Array.isArray(value) ? value.join(', ') : value;
          formatted += `<tr><td>${key}</td><td>${displayValue}</td></tr>`;
        }
      } else {
        // Fallback to raw text if not parsed
        formatted += `<tr><td colspan="2"><pre>${whoisData}</pre></td></tr>`;
      }

      formatted += '</table>';
      resultsDiv.innerHTML = whoisData ? formatted : 'No WHOIS data found for this domain.';

      // Add export button for registered domains
      if (whoisData) {
        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'Download JSON';
        exportBtn.style.marginTop = '20px';
        exportBtn.className = 'btn btn-primary';
        exportBtn.onclick = () => {
          const exportData = {
            domain: domain,
            latency: `${latency} ms`,
            whois: whoisData
          };
          const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${domain}_whois.json`;
          a.click();
          URL.revokeObjectURL(url);
        };
        resultsDiv.appendChild(exportBtn);
      }

    } catch (error) {
      console.error('Error in WHOIS lookup:', error);
      resultsDiv.innerHTML = `Error: ${error.message}. Please check the domain and try again.`;
    }
  });
</script>