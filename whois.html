---
layout: page
title: WHOIS Lookup
subtitle: Retrieve WHOIS information for a domain.
share-description: "IP Cow is a free service that shows you the public IP address of your device along with information about your computer and web browser. IP Cow also offers an Ookla Speedtest and other network resources and tools."
# full-width: true
---
<form class="form-inline justify-content-center" method="GET" action="/api/whois.php" novalidate>
  <input type="text" class="form-control" id="domain" name="domain" placeholder="google.com" required>
  <!-- hCaptcha Widget -->
  <div class="h-captcha" data-sitekey="1eb25e26-63d0-476a-bcb6-ae62a2b04752"></div>
  <button type="submit" class="btn btn-primary">Check WHOIS</button>
</form>
<div id="whois-results" class="center-results"></div>

<!-- Load hCaptcha JavaScript -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    let hcaptchaReady = false;
    let hcaptchaResponse = null;
    let hcaptchaPromiseResolve = null;
    let hcaptchaPromiseReject = null;
    const hcaptchaReadyPromise = new Promise((resolve, reject) => {
      hcaptchaPromiseResolve = resolve;
      hcaptchaPromiseReject = reject;
    });

    // Callback when hCaptcha is completed
    window.hcaptchaOnloadCallback = function() {
      console.log('hCaptcha script loaded');
    };

    // Callback when hCaptcha is verified
    window.hcaptchaVerifiedCallback = function(response) {
      console.log('hCaptcha verified with response:', response);
      hcaptchaResponse = response;
      hcaptchaReady = true;
      hcaptchaPromiseResolve();
    };

    // Add the verified callback to the global scope for hCaptcha
    window.hcaptchaVerifiedCallback = window.hcaptchaVerifiedCallback;

    // Timeout for hCaptcha verification (30 seconds)
    setTimeout(() => {
      if (!hcaptchaReady) {
        const resultsDiv = document.getElementById('whois-results');
        if (resultsDiv) {
          resultsDiv.innerHTML = 'Error: hCaptcha verification timed out. Please refresh and try again.';
        }
        console.error('hCaptcha verification timed out after 30 seconds');
        hcaptchaPromiseReject(new Error('hCaptcha verification timed out'));
      }
    }, 30000);

    // Form submission handling
    const form = document.querySelector('form');
    if (!form) {
      console.error('Form not found');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const resultsDiv = document.getElementById('whois-results');
      if (!resultsDiv) {
        console.error('Results div not found');
        return;
      }

      resultsDiv.innerHTML = 'Please complete the hCaptcha challenge...';
      try {
        await hcaptchaReadyPromise; // Wait for hCaptcha to be verified
        console.log('hCaptcha ready, proceeding with submission');
      } catch (err) {
        console.error('hCaptcha readiness failed:', err);
        resultsDiv.innerHTML = 'Error: hCaptcha verification failed. Please refresh and try again.';
        return;
      }

      if (!hcaptchaResponse) {
        resultsDiv.innerHTML = 'Error: hCaptcha response not available. Please complete the challenge and try again.';
        console.error('hCaptcha response not available');
        return;
      }

      let domain = document.getElementById('domain').value.trim();
      domain = domain.replace(/^https?:\/\//, '').replace(/:[0-9]+$/, '').replace(/[\/]+$/, '').split('/')[0];

      resultsDiv.innerHTML = 'Loading...';
      console.log('Submitting form with domain:', domain, 'and hCaptcha response:', hcaptchaResponse);

      try {
        const startTime = performance.now();
        const response = await fetch(`/api/whois.php?domain=${encodeURIComponent(domain)}&h-captcha-response=${encodeURIComponent(hcaptchaResponse)}`);
        const endTime = performance.now();
        const latency = (endTime - startTime).toFixed(2);

        if (!response.ok) {
          const text = await response.text();
          console.error('Server response:', text);
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Received WHOIS response:', data);

        if (!data.success || data.error) {
          resultsDiv.innerHTML = data.error || 'No WHOIS data found.';
          return;
        }

        if (data.available) {
          resultsDiv.innerHTML = `<div class="available-message">The domain "${domain}" is available and has not been registered.</div>`;
          return;
        }

        const whoisData = data.whois || {};
        let formatted = '<table><tr><th>Metric</th><th>Value</th></tr>';
        formatted += `<tr><td>Domain</td><td>${domain}</td></tr>`;
        formatted += `<tr><td>Client Latency</td><td>${latency} ms</td></tr>`;
        formatted += '<tr><td colspan="2"><strong>WHOIS Data</strong></td></tr>';

        if (typeof whoisData === 'object' && !Array.isArray(whoisData)) {
          for (const [key, value] of Object.entries(whoisData)) {
            const displayValue = Array.isArray(value) ? value.join(', ') : value;
            formatted += `<tr><td>${key}</td><td>${displayValue}</td></tr>`;
          }
        } else {
          formatted += `<tr><td colspan="2"><pre>${whoisData}</pre></td></tr>`;
        }
        formatted += '</table>';
        resultsDiv.innerHTML = whoisData ? formatted : 'No WHOIS data found for this domain.';

        if (whoisData) {
          const exportBtn = document.createElement('button');
          exportBtn.textContent = 'Download JSON';
          exportBtn.style.marginTop = '20px';
          exportBtn.className = 'btn btn-primary';
          exportBtn.onclick = () => {
            const exportData = { domain, latency: `${latency} ms`, whois: whoisData };
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${domain}_whois.json`;
            a.click();
            URL.revokeObjectURL(url);
          };
          resultsDiv.appendChild(exportBtn);
        }
      } catch (error) {
        console.error('Error in WHOIS lookup:', error);
        resultsDiv.innerHTML = `Error: ${error.message}. Please check the domain and try again.`;
      }
    });
  });
</script>