---
layout: page
title: WHOIS Lookup
subtitle: Retrieve WHOIS information for a domain.
share-description: "IP Cow is a free service that shows you the public IP address of your device along with information about your computer and web browser. IP Cow also offers an Ookla Speedtest and other network resources and tools."
# full-width: true
---
<form class="form-inline justify-content-center" method="GET" action="/api/whois.php" novalidate>
  <input type="text" class="form-control" id="domain" name="domain" placeholder="google.com" required>
  <div id="hcaptcha-widget" class="h-captcha" data-sitekey="1eb25e26-63d0-476a-bcb6-ae62a2b04752" data-size="invisible" data-callback="hcaptchaVerifyCallback"></div>
  <button type="submit" class="btn btn-primary">Check WHOIS</button>
</form>
<div id="whois-results" class="center-results"></div>

<!-- Load hCaptcha and custom module -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>
<script src="/assets/js/hcaptcha-module.js" defer></script>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const hcaptchaManager = new HcaptchaManager({
      formSelector: 'form',
      resultsId: 'whois-results'
    });

    const form = document.querySelector('form');
    if (!form) {
      console.error('Form not found');
      return;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Reset hCaptcha before each submission
      hcaptchaManager.resetHcaptcha();

      const success = await hcaptchaManager.executeHcaptcha();
      if (!success) return;

      let domain = document.getElementById('domain').value.trim();
      domain = domain.replace(/^https?:\/\//, '').replace(/:[0-9]+$/, '').replace(/[\/]+$/, '').split('/')[0];

      const resultsDiv = document.getElementById('whois-results');
      resultsDiv.innerHTML = 'Loading...';
      console.log('Submitting form with domain:', domain, 'and hCaptcha response:', hcaptchaManager.getHcaptchaResponse());

      try {
        const startTime = performance.now();
        const response = await fetch(`/api/whois.php?domain=${encodeURIComponent(domain)}&h-captcha-response=${encodeURIComponent(hcaptchaManager.getHcaptchaResponse())}`);
        const endTime = performance.now();
        const latency = (endTime - startTime).toFixed(2);

        if (!response.ok) {
          const text = await response.text();
          console.error('Server response:', text);
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Received WHOIS response:', data);

        const whoisData = data.whois || '';
        if (!whoisData || whoisData.trim() === '') {
          resultsDiv.innerHTML = 'No WHOIS data found for this domain.';
          return;
        }

        let formatted = '<table><tr><th>Metric</th><th>Value</th></tr>';
        formatted += `<tr><td>Domain</td><td>${domain}</td></tr>`;
        formatted += `<tr><td>Client Latency</td><td>${latency} ms</td></tr>`;
        formatted += `<tr><td>WHOIS Time</td><td>${data.whois_time_ms.toFixed(2)} ms</td></tr>`;
        formatted += `<tr><td>Total Time</td><td>${data.total_time_ms.toFixed(2)} ms</td></tr>`;
        formatted += '<tr><td colspan="2"><strong>WHOIS Data</strong></td></tr>';
        formatted += `<tr><td colspan="2"><pre>${whoisData.trim()}</pre></td></tr>`;
        formatted += '</table>';

        resultsDiv.innerHTML = formatted;

        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'Download JSON';
        exportBtn.style.marginTop = '20px';
        exportBtn.className = 'btn btn-primary';
        exportBtn.onclick = () => {
          const exportData = { domain, latency: `${latency} ms`, whois: whoisData, whois_time_ms: data.whois_time_ms, total_time_ms: data.total_time_ms };
          const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${domain}_whois.json`;
          a.click();
          URL.revokeObjectURL(url);
        };
        resultsDiv.appendChild(exportBtn);
      } catch (error) {
        console.error('Error in WHOIS lookup:', error);
        resultsDiv.innerHTML = `Error: ${error.message}. Please check the domain and try again.`;
      }
    });
  });
</script>