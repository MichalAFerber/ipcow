---
layout: page
title: WHOIS Lookup
subtitle: Retrieve WHOIS information for a domain.
share-description: "IP Cow is a free service that shows you the public IP address of your device along with information about your computer and web browser. IP Cow also offers an Ookla Speedtest and other network resources and tools."
# full-width: true
---
<form class="form-inline justify-content-center" method="GET" action="/api/whois.php" novalidate>
  <input type="text" class="form-control" id="domain" name="domain" placeholder="google.com" required>
  <div id="hcaptcha-widget" class="h-captcha" data-sitekey="1eb25e26-63d0-476a-bcb6-ae62a2b04752" data-size="invisible" data-callback="hcaptchaVerifyCallback"></div>
  <button type="submit" class="btn btn-primary">Check WHOIS</button>
</form>

<div id="whois-results" style="display: none;"></div>

<!-- Load hCaptcha and custom module -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>
<script src="/assets/js/hcaptcha-module.js" defer></script>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const hcaptchaManager = new HcaptchaManager({
      formSelector: 'form',
      resultsId: 'whois-results'
    });

    const form = document.querySelector('form');
    if (!form) {
      console.error('Form not found');
      return;
    }

    // Function to parse raw WHOIS string into structured data
    function parseWhoisData(rawWhois, queriedDomain) {
      const lines = rawWhois.split('\n').map(line => line.trim());
      const whoisData = {
        domain_name: queriedDomain, // Set the domain_name to the queried domain
        registrar: {},
        dates: {},
        status: [],
        name_servers: [],
        registrant: {},
        admin: {},
        tech: {},
        billing: {},
        raw: {} // Store unmapped fields
      };

      console.log('Parsing WHOIS data, total lines:', lines.length); // Debug

      let currentContactType = null; // Track the current contact type (administrative, technical, etc.)
      let inContactSection = false; // Track if we are in a contact section

      const stopMarkers = [
        '>>> Last update of WHOIS database:',
        '>>>_last_update_of_whois_database'
      ];
      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];
        let stopMarkerFound = false;
        for (const marker of stopMarkers) {
          if (line.startsWith(marker)) {
            whoisData.last_updated = line.split(marker)[1].trim();
            console.log('Found stop marker, last_updated:', whoisData.last_updated); // Debug
            stopMarkerFound = true;
            break;
          }
        }
        if (stopMarkerFound) break;

        if (!line || line.startsWith('#') || line.startsWith('%')) continue;

        // Split on the first colon
        const match = line.match(/([^:]+):(.+)/);
        if (!match) {
          console.log('Skipping line (no key-value pair):', line); // Debug
          // If we encounter a blank line or a line without a key-value pair, end the contact section
          if (inContactSection) {
            currentContactType = null;
            inContactSection = false;
          }
          continue;
        }
        const key = match[1].trim().toLowerCase().replace(/\s+/g, '_');
        let value = match[2].trim();

        // Map alternative keys
        let mappedKey = key;
        if (key === 'nserver') mappedKey = 'name_server';
        else if (key === 'fax-no') mappedKey = 'fax';

        console.log(`Parsed line - key: ${key}, mappedKey: ${mappedKey}, value: ${value}`); // Debug

        // Handle contact sections (e.g., administrative, technical)
        if (mappedKey === 'contact') {
          currentContactType = value.toLowerCase();
          inContactSection = true;
          continue;
        }

        // Handle fields based on the current contact type
        if (currentContactType && inContactSection) {
          let targetObject;
          if (currentContactType === 'administrative') targetObject = whoisData.registrant; // Map administrative to registrant
          else if (currentContactType === 'technical') targetObject = whoisData.tech;
          else if (currentContactType === 'billing') targetObject = whoisData.billing;
          else targetObject = whoisData.admin;

          if (mappedKey === 'name') targetObject.name = value;
          else if (mappedKey === 'organisation') targetObject.organization = value;
          else if (mappedKey === 'address') {
            if (!targetObject.street) targetObject.street = value;
            else if (!targetObject.city) targetObject.city = value;
            else if (!targetObject.country) targetObject.country = value;
          }
          else if (mappedKey === 'phone') targetObject.phone = value;
          else if (mappedKey === 'fax') targetObject.fax = value;
          else if (mappedKey === 'e-mail') targetObject.email = value;
          else {
            whoisData.raw[mappedKey] = value;
          }
          continue;
        }

        // Handle specific keys
        if (mappedKey === 'domain_name') whoisData.domain_name = value;
        else if (mappedKey === 'registry_domain_id') whoisData.registry_domain_id = value;
        else if (mappedKey.startsWith('registrar')) {
          if (mappedKey === 'registrar') whoisData.registrar.name = value;
          else if (mappedKey === 'registrar_whois_server') whoisData.registrar.whois_server = value;
          else if (mappedKey === 'registrar_url') whoisData.registrar.url = value;
          else if (mappedKey === 'registrar_iana_id') whoisData.registrar.iana_id = value;
          else if (mappedKey === 'registrar_abuse_contact_email') whoisData.registrar.abuse_contact_email = value;
          else if (mappedKey === 'registrar_abuse_contact_phone') whoisData.registrar.abuse_contact_phone = value;
        } else if (mappedKey === 'organisation') {
          whoisData.registrar.name = value; // Map organisation to registrar for IANA data
        } else if (mappedKey === 'updated_date' || mappedKey === 'creation_date' || mappedKey === 'registrar_registration_expiration_date' || mappedKey === 'registry_expiry_date' || mappedKey === 'changed' || mappedKey === 'created') {
          if (mappedKey === 'updated_date' || mappedKey === 'changed') whoisData.dates.updated = value;
          else if (mappedKey === 'creation_date' || mappedKey === 'created') whoisData.dates.created = value;
          else if (mappedKey === 'registrar_registration_expiration_date' || mappedKey === 'registry_expiry_date') whoisData.dates.expiry = value;
        } else if (mappedKey === 'domain_status' || mappedKey === 'status') {
          whoisData.status.push(value);
        } else if (mappedKey === 'name_server') {
          whoisData.name_servers.push(value);
        } else if (mappedKey === 'dnssec') {
          whoisData.dnssec = value;
        } else if (mappedKey.startsWith('registrant')) {
          if (mappedKey === 'registrant_name') whoisData.registrant.name = value;
          else if (mappedKey === 'registrant_organization') whoisData.registrant.organization = value;
          else if (mappedKey === 'registrant_street') whoisData.registrant.street = value;
          else if (mappedKey === 'registrant_city') whoisData.registrant.city = value;
          else if (mappedKey === 'registrant_state/province') whoisData.registrant.state_province = value;
          else if (mappedKey === 'registrant_postal_code') whoisData.registrant.postal_code = value;
          else if (mappedKey === 'registrant_country') whoisData.registrant.country = value;
          else if (mappedKey === 'registrant_phone') whoisData.registrant.phone = value;
          else if (mappedKey === 'registrant_phone_ext') whoisData.registrant.phone_ext = value;
          else if (mappedKey === 'registrant_fax') whoisData.registrant.fax = value;
          else if (mappedKey === 'registrant_fax_ext') whoisData.registrant.fax_ext = value;
          else if (mappedKey === 'registrant_email') whoisData.registrant.email = value;
        } else if (mappedKey.startsWith('admin')) {
          if (mappedKey === 'admin_name') whoisData.admin.name = value;
          else if (mappedKey === 'admin_organization') whoisData.admin.organization = value;
          else if (mappedKey === 'admin_street') whoisData.admin.street = value;
          else if (mappedKey === 'admin_city') whoisData.admin.city = value;
          else if (mappedKey === 'admin_state/province') whoisData.admin.state_province = value;
          else if (mappedKey === 'admin_postal_code') whoisData.admin.postal_code = value;
          else if (mappedKey === 'admin_country') whoisData.admin.country = value;
          else if (mappedKey === 'admin_phone') whoisData.admin.phone = value;
          else if (mappedKey === 'admin_phone_ext') whoisData.admin.phone_ext = value;
          else if (mappedKey === 'admin_fax') whoisData.admin.fax = value;
          else if (mappedKey === 'admin_fax_ext') whoisData.admin.fax_ext = value;
          else if (mappedKey === 'admin_email') whoisData.admin.email = value;
        } else if (mappedKey.startsWith('tech')) {
          if (mappedKey === 'tech_name') whoisData.tech.name = value;
          else if (mappedKey === 'tech_organization') whoisData.tech.organization = value;
          else if (mappedKey === 'tech_street') whoisData.tech.street = value;
          else if (mappedKey === 'tech_city') whoisData.tech.city = value;
          else if (mappedKey === 'tech_state/province') whoisData.tech.state_province = value;
          else if (mappedKey === 'tech_postal_code') whoisData.tech.postal_code = value;
          else if (mappedKey === 'tech_country') whoisData.tech.country = value;
          else if (mappedKey === 'tech_phone') whoisData.tech.phone = value;
          else if (mappedKey === 'tech_phone_ext') whoisData.tech.phone_ext = value;
          else if (mappedKey === 'tech_fax') whoisData.tech.fax = value;
          else if (mappedKey === 'tech_fax_ext') whoisData.tech.fax_ext = value;
          else if (mappedKey === 'tech_email') whoisData.tech.email = value;
        } else if (mappedKey.startsWith('billing')) {
          if (mappedKey === 'billing_name') whoisData.billing.name = value;
          else if (mappedKey === 'billing_organization') whoisData.billing.organization = value;
          else if (mappedKey === 'billing_street') whoisData.billing.street = value;
          else if (mappedKey === 'billing_city') whoisData.billing.city = value;
          else if (mappedKey === 'billing_state/province') whoisData.billing.state_province = value;
          else if (mappedKey === 'billing_postal_code') whoisData.billing.postal_code = value;
          else if (mappedKey === 'billing_country') whoisData.billing.country = value;
          else if (mappedKey === 'billing_phone') whoisData.billing.phone = value;
          else if (mappedKey === 'billing_phone_ext') whoisData.billing.phone_ext = value;
          else if (mappedKey === 'billing_fax') whoisData.billing.fax = value;
          else if (mappedKey === 'billing_fax_ext') whoisData.billing.fax_ext = value;
          else if (mappedKey === 'billing_email') whoisData.billing.email = value;
        } else {
          whoisData.raw[mappedKey] = value; // Store unmapped fields
        }
      }

      // Remove empty nested objects
      if (!Object.keys(whoisData.registrar).length) delete whoisData.registrar;
      if (!Object.keys(whoisData.dates).length) delete whoisData.dates;
      if (!whoisData.status.length) delete whoisData.status;
      if (!whoisData.name_servers.length) delete whoisData.name_servers;
      if (!Object.keys(whoisData.registrant).length) delete whoisData.registrant;
      if (!Object.keys(whoisData.admin).length) delete whoisData.admin;
      if (!Object.keys(whoisData.tech).length) delete whoisData.tech;
      if (!Object.keys(whoisData.billing).length) delete whoisData.billing;
      if (!Object.keys(whoisData.raw).length) delete whoisData.raw;

      console.log('Parsed WHOIS data:', whoisData); // Debug
      return whoisData;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      hcaptchaManager.resetHcaptcha();
      const success = await hcaptchaManager.executeHcaptcha();
      if (!success) {
        const resultsDiv = document.getElementById('whois-results');
        resultsDiv.innerHTML = 'hCaptcha verification failed. Please try again or check your network connection.';
        return;
      }

      let domain = document.getElementById('domain').value.trim();
      domain = domain.replace(/^https?:\/\//, '').replace(/:[0-9]+$/, '').replace(/[\/]+$/, '').split('/')[0];

      const resultsDiv = document.getElementById('whois-results');
      resultsDiv.style.display = 'block';
      resultsDiv.innerHTML = 'Loading...';
      //console.log('Submitting form with domain:', domain, 'and hCaptcha response:', hcaptchaManager.getHcaptchaResponse());

      try {
        const startTime = performance.now();
        const response = await fetch(`/api/whois.php?domain=${encodeURIComponent(domain)}&h-captcha-response=${encodeURIComponent(hcaptchaManager.getHcaptchaResponse())}`);
        const endTime = performance.now();
        const latency = (endTime - startTime).toFixed(2);

        if (!response.ok) {
          const text = await response.text();
          console.error('Server response:', text);
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Received WHOIS response:', data);

        const whoisData = data.whois || '';
        if (!whoisData || whoisData.trim() === '') {
          resultsDiv.innerHTML = 'No WHOIS data found for this domain.';
          return;
        }

        // Format the response into a table
        let formatted = '';
        formatted += `<h3 class="text-center"><span class="font-weight-bold">${domain}</span></h3>`;
        formatted += '<div class="mt-5 main-explain-area jumbotron jumbotron-fluid"><section class="m-0 p-0">';
        formatted = '<p class="lead font-weight-bold pt-0 mt-0">WHOIS Data</p>';
        formatted += <pre style="white-space: pre-wrap; word-wrap: break-word;">${whoisData.trim()}</pre>;
        formatted += '</section></div>';

        resultsDiv.innerHTML = formatted;

        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'Download JSON';
        exportBtn.style.marginTop = '20px';
        exportBtn.className = 'btn btn-primary';
        exportBtn.onclick = () => {
          const parsedWhois = parseWhoisData(whoisData, domain);
          const exportData = {
            domain: domain,
            whois: parsedWhois
          };
          const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${domain}_whois.json`;
          a.click();
          URL.revokeObjectURL(url);
        };
        resultsDiv.appendChild(exportBtn);
      } catch (error) {
        console.error('Error in WHOIS lookup:', error);
        resultsDiv.innerHTML = `Error: ${error.message}. Please check the domain and try again.`;
      }
    });
  });
</script>