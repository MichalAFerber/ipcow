---
layout: page
title: WHOIS Lookup
subtitle: Retrieve WHOIS information for a domain.
share-description: "IP Cow is a free service that shows you the public IP address of your device along with information about your computer and web browser. IP Cow also offers an Ookla Speedtest and other network resources and tools."
# full-width: true
---
<form class="form-inline justify-content-center" method="GET" action="/api/whois.php" novalidate>
  <input type="text" class="form-control" id="domain" name="domain" placeholder="google.com" required>
  <div id="hcaptcha-widget" class="h-captcha" data-sitekey="1eb25e26-63d0-476a-bcb6-ae62a2b04752" data-size="invisible" data-callback="hcaptchaVerifyCallback"></div>
  <button type="submit" class="btn btn-primary">Check WHOIS</button>
</form>
<div id="whois-results" class="center-results"></div>

<!-- Load hCaptcha and custom module -->
<script src="https://js.hcaptcha.com/1/api.js" async defer></script>
<script src="/assets/js/hcaptcha-module.js" defer></script>

<script type="module">
  document.addEventListener('DOMContentLoaded', () => {
    const hcaptchaManager = new HcaptchaManager({
      formSelector: 'form',
      resultsId: 'whois-results'
    });

    const form = document.querySelector('form');
    if (!form) {
      console.error('Form not found');
      return;
    }

    // Function to parse raw WHOIS string into structured data
    function parseWhoisData(rawWhois) {
      const lines = rawWhois.split('\r\n').map(line => line.trim());
      const whoisData = {
        registrar: {},
        dates: {},
        status: [],
        name_servers: [],
        registrant: {},
        admin: {},
        tech: {}
      };

      const stopMarker = '>>> Last update of WHOIS database:';
      for (const line of lines) {
        if (line.startsWith(stopMarker)) {
          whoisData.last_updated = line.split(stopMarker)[1].trim();
          break;
        }
        if (!line || line.startsWith('#')) continue;

        // Split on the first colon
        const [keyPart, valuePart] = line.split(/:(.+)/);
        if (!valuePart) continue; // Skip lines without a value after colon
        const key = keyPart.trim().toLowerCase().replace(/\s+/g, '_');
        const value = valuePart.trim();

        // Handle specific keys
        if (key === 'domain_name') whoisData.domain_name = value;
        else if (key === 'registry_domain_id') whoisData.registry_domain_id = value;
        else if (key.startsWith('registrar')) {
          if (key === 'registrar') whoisData.registrar.name = value;
          else if (key === 'registrar_whois_server') whoisData.registrar.whois_server = value;
          else if (key === 'registrar_url') whoisData.registrar.url = value;
          else if (key === 'registrar_iana_id') whoisData.registrar.iana_id = value;
          else if (key === 'registrar_abuse_contact_email') whoisData.registrar.abuse_contact_email = value;
          else if (key === 'registrar_abuse_contact_phone') whoisData.registrar.abuse_contact_phone = value;
        } else if (key === 'updated_date' || key === 'creation_date' || key === 'registrar_registration_expiration_date') {
          if (key === 'updated_date') whoisData.dates.updated = value;
          else if (key === 'creation_date') whoisData.dates.created = value;
          else if (key === 'registrar_registration_expiration_date') whoisData.dates.expiry = value;
        } else if (key === 'domain_status') whoisData.status.push(value);
        else if (key === 'name_server') whoisData.name_servers.push(value);
        else if (key === 'dnssec') whoisData.dnssec = value;
        else if (key.startsWith('registrant')) {
          if (key === 'registrant_organization') whoisData.registrant.organization = value;
          else if (key === 'registrant_state/province') whoisData.registrant.state_province = value;
          else if (key === 'registrant_country') whoisData.registrant.country = value;
          else if (key === 'registrant_email') whoisData.registrant.email = value;
        } else if (key.startsWith('admin')) {
          if (key === 'admin_organization') whoisData.admin.organization = value;
          else if (key === 'admin_state/province') whoisData.admin.state_province = value;
          else if (key === 'admin_country') whoisData.admin.country = value;
          else if (key === 'admin_email') whoisData.admin.email = value;
        } else if (key.startsWith('tech')) {
          if (key === 'tech_organization') whoisData.tech.organization = value;
          else if (key === 'tech_state/province') whoisData.tech.state_province = value;
          else if (key === 'tech_country') whoisData.tech.country = value;
          else if (key === 'tech_email') whoisData.tech.email = value;
        }
      }

      // Remove empty nested objects
      if (!Object.keys(whoisData.registrar).length) delete whoisData.registrar;
      if (!Object.keys(whoisData.dates).length) delete whoisData.dates;
      if (!whoisData.status.length) delete whoisData.status;
      if (!whoisData.name_servers.length) delete whoisData.name_servers;
      if (!Object.keys(whoisData.registrant).length) delete whoisData.registrant;
      if (!Object.keys(whoisData.admin).length) delete whoisData.admin;
      if (!Object.keys(whoisData.tech).length) delete whoisData.tech;

      return whoisData;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      hcaptchaManager.resetHcaptcha();
      const success = await hcaptchaManager.executeHcaptcha();
      if (!success) return;

      let domain = document.getElementById('domain').value.trim();
      domain = domain.replace(/^https?:\/\//, '').replace(/:[0-9]+$/, '').replace(/[\/]+$/, '').split('/')[0];

      const resultsDiv = document.getElementById('whois-results');
      resultsDiv.innerHTML = 'Loading...';
      console.log('Submitting form with domain:', domain, 'and hCaptcha response:', hcaptchaManager.getHcaptchaResponse());

      try {
        const startTime = performance.now();
        const response = await fetch(`/api/whois.php?domain=${encodeURIComponent(domain)}&h-captcha-response=${encodeURIComponent(hcaptchaManager.getHcaptchaResponse())}`);
        const endTime = performance.now();
        const latency = (endTime - startTime).toFixed(2);

        if (!response.ok) {
          const text = await response.text();
          console.error('Server response:', text);
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        console.log('Received WHOIS response:', data);

        const whoisData = data.whois || '';
        if (!whoisData || whoisData.trim() === '') {
          resultsDiv.innerHTML = 'No WHOIS data found for this domain.';
          return;
        }

        // Format the response into a table
        let formatted = '<table class="table table-striped"><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody>';
        formatted += `<tr><td>Domain</td><td>${domain}</td></tr>`;
        formatted += `<tr><td>Client Latency</td><td>${latency} ms</td></tr>`;
        formatted += `<tr><td>WHOIS Time</td><td>${data.whois_time_ms.toFixed(2)} ms</td></tr>`;
        formatted += `<tr><td>Total Time</td><td>${data.total_time_ms.toFixed(2)} ms</td></tr>`;
        formatted += '<tr><td colspan="2"><strong>WHOIS Data</strong></td></tr>';
        formatted += `<tr><td colspan="2"><pre style="white-space: pre-wrap; word-wrap: break-word;">${whoisData.trim()}</pre></td></tr>`;
        formatted += '</tbody></table>';

        resultsDiv.innerHTML = formatted;

        const exportBtn = document.createElement('button');
        exportBtn.textContent = 'Download JSON';
        exportBtn.style.marginTop = '20px';
        exportBtn.className = 'btn btn-primary';
        exportBtn.onclick = () => {
          const parsedWhois = parseWhoisData(whoisData);
          const exportData = {
            domain: domain,
            latency_ms: parseFloat(latency),
            whois: parsedWhois,
            timings: {
              whois_ms: parseFloat(data.whois_time_ms.toFixed(2)),
              total_ms: parseFloat(data.total_time_ms.toFixed(2))
            }
          };
          const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${domain}_whois.json`;
          a.click();
          URL.revokeObjectURL(url);
        };
        resultsDiv.appendChild(exportBtn);
      } catch (error) {
        console.error('Error in WHOIS lookup:', error);
        resultsDiv.innerHTML = `Error: ${error.message}. Please check the domain and try again.`;
      }
    });
  });
</script>