<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêÆ IP Cow</title>
    <!-- Bowser CDN (lowercase 'bowser' global) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bowser/2.11.0/bundled.min.js"></script>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; max-width: 900px; margin: 40px auto; padding: 20px; background: #f9f9fb; color: #333; }
        h1 { text-align: center; color: #2c3e50; }
        .section { background: white; border-radius: 12px; padding: 20px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .label { font-weight: bold; font-size: 1.2em; margin-bottom: 12px; color: #34495e; }
        table { width: 100%; border-collapse: collapse; font-family: monospace; font-size: 1em; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f1f1f1; width: 30%; }
        .ip-display { font-size: 1.6em; font-weight: bold; color: #2c3e50; margin-bottom: 8px; }
        .progress-bar { width: 100%; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .progress { height: 100%; width: 0%; background: #3498db; transition: width 0.3s ease; }
        .loading .progress { width: 100%; animation: pulse 1.5s infinite; }
        .success .progress { background: #27ae60; width: 100%; }
        .error .progress { background: #e74c3c; width: 100%; }
        @keyframes pulse { 0% { opacity: 0.6; } 50% { opacity: 1; } 100% { opacity: 0.6; } }
        .ua-value { font-family: monospace; background: #f8f8f8; padding: 2px 6px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üêÆ IP Cow</h1>

    <div class="section">
        <div class="label">Your IP Addresses</div>
        <div id="ipv4-container" class="loading">
            <div class="ip-display" id="ipv4-ip">Loading IPv4...</div>
            <div class="progress-bar"><div class="progress"></div></div>
        </div>
        <div id="ipv6-container" class="loading" style="margin-top:20px;">
            <div class="ip-display" id="ipv6-ip">Loading IPv6...</div>
            <div class="progress-bar"><div class="progress"></div></div>
        </div>
        <div id="ip-details" style="margin-top:30px; display:none;">
            <table id="ip-table"></table>
        </div>
    </div>

    <div class="section">
        <div class="label">Your Device & Browser (via Bowser + Browser APIs)</div>
        <div id="ua-container">
            <table id="ua-table"></table>
        </div>
    </div>

    <script>
        const IPSTACK_KEY = '34df1070bcc7d00920472b33404843ef'; // Free from ipstack.com

        // Reliable free services with proper CORS and protocol forcing (as of 2026)
        const IPV4_ENDPOINT = 'https://ipv4.jsonip.com';     // IPv4-only hostname, CORS enabled
        const IPV6_ENDPOINT = 'https://ipv6.jsonip.com';     // IPv6-only hostname, CORS enabled

        async function fetchIPv4() {
            const container = document.getElementById('ipv4-container');
            const ipEl = document.getElementById('ipv4-ip');

            try {
                const response = await fetch(IPV4_ENDPOINT, { signal: AbortSignal.timeout(8000) });
                if (!response.ok) throw new Error();
                const data = await response.json();
                ipEl.textContent = data.ip || 'Unknown';
                container.classList.remove('loading', 'error');
                container.classList.add('success');
            } catch (err) {
                ipEl.textContent = 'Unable to fetch (no IPv4 connectivity)';
                container.classList.remove('loading', 'success');
                container.classList.add('error');
            }
        }

        async function fetchIPv6AndGeo() {
            const container = document.getElementById('ipv6-container');
            const ipEl = document.getElementById('ipv6-ip');

            try {
                const response = await fetch(IPV6_ENDPOINT, { signal: AbortSignal.timeout(8000) });
                if (response.ok) {
                    const data = await response.json();
                    ipEl.textContent = data.ip || 'Unknown';
                    container.classList.remove('loading', 'error');
                    container.classList.add('success');
                } else {
                    throw new Error();
                }

                // Full geolocation from ipstack (dual-stack, prefers IPv6 if connected)
                const geoResponse = await fetch(`https://api.ipstack.com/check?access_key=${IPSTACK_KEY}`, { signal: AbortSignal.timeout(8000) });
                if (!geoResponse.ok) throw new Error();
                const geoData = await geoResponse.json();
                displayIPDetails(geoData);

            } catch (err) {
                ipEl.textContent = 'Not available (no IPv6 connectivity)';
                container.classList.remove('loading', 'success');
                container.classList.add('error');

                // Fallback geolocation via ipstack (will use IPv4)
                try {
                    const fallbackGeo = await fetch(`https://api.ipstack.com/check?access_key=${IPSTACK_KEY}`);
                    const fallbackData = await fallbackGeo.json();
                    displayIPDetails(fallbackData);
                } catch (fallbackErr) {
                    // Silent
                }
            }
        }

        function displayIPDetails(data) {
            const table = document.getElementById('ip-table');
            table.innerHTML = '';

            const fields = {
                ip: 'IP Address (Detected)',
                type: 'IP Type',
                continent_name: 'Continent',
                country_name: 'Country',
                region_name: 'Region',
                city: 'City',
                zip: 'ZIP Code',
                latitude: 'Latitude',
                longitude: 'Longitude',
            };

            for (const key in fields) {
                if (data[key] !== undefined && data[key] !== null) {
                    const row = table.insertRow();
                    row.insertCell(0).textContent = fields[key];
                    const cell = row.insertCell(1);
                    cell.innerHTML = `<span class="ua-value">${data[key]}</span>`;
                }
            }

            if (data.connection) {
                const row = table.insertRow();
                row.insertCell(0).textContent = 'ISP / Organization';
                const cell = row.insertCell(1);
                cell.innerHTML = `<span class="ua-value">${data.connection.org || data.connection.isp || 'Unknown'}</span>`;
            }

            if (data.time_zone) {
                const tz = data.time_zone;
                const row = table.insertRow();
                row.insertCell(0).textContent = 'Timezone';
                const cell = row.insertCell(1);
                cell.innerHTML = `<span class="ua-value">${tz.name} (Offset: GMT${tz.offset >= 0 ? '+' : ''}${tz.offset})</span>`;
            }

            document.getElementById('ip-details').style.display = 'block';
        }

        function parseClientInfo() {
            const parser = bowser.getParser(navigator.userAgent);
            const browser = parser.getBrowser();
            const os = parser.getOS();
            const engine = parser.getEngine();
            const platform = parser.getPlatform();

            const table = document.getElementById('ua-table');
            table.innerHTML = '';

            const sections = [
                { title: 'Browser', data: { Name: browser.name, Version: browser.version } },
                { title: 'Engine', data: { Name: engine.name, Version: engine.version } },
                { title: 'OS', data: { Name: os.name, Version: os.version || os.versionName } },
                { title: 'Platform', data: { Type: platform.type } }
            ];

            sections.forEach(section => {
                const hasValue = Object.values(section.data).some(v => v);
                if (!hasValue) return;

                const headerRow = table.insertRow();
                const headerCell = headerRow.insertCell(0);
                headerCell.textContent = section.title;
                headerCell.colSpan = 2;
                headerCell.style.fontWeight = 'bold';
                headerCell.style.background = '#f1f1f1';

                for (const key in section.data) {
                    const value = section.data[key];
                    if (value) {
                        const row = table.insertRow();
                        row.insertCell(0).textContent = key;
                        const cell = row.insertCell(1);
                        cell.innerHTML = `<span class="ua-value">${value}</span>`;
                    }
                }
            });

            const clientFields = {
                'Viewport Size': `${window.innerWidth} √ó ${window.innerHeight}`,
                'Screen Resolution': `${screen.width} √ó ${screen.height}`
            };

            for (const label in clientFields) {
                const row = table.insertRow();
                row.insertCell(0).textContent = label;
                const cell = row.insertCell(1);
                cell.innerHTML = `<span class="ua-value">${clientFields[label]}</span>`;
            }
        }

        // Run on load
        Promise.allSettled([fetchIPv4(), fetchIPv6AndGeo()]).finally(parseClientInfo);
    </script>
</body>
</html>